!function(e){"use strict";function n(e,n){function t(){}t.prototype=e;var r=new t;for(var o in n)r[o]=n[o];return n.toString!==Object.prototype.toString&&(r.toString=n.toString),r}function t(e,n){if(null==n)return null;null==n.__id__&&(n.__id__=h++);var t;return null==e.hx__closures__?e.hx__closures__={}:t=e.hx__closures__[n.__id__],null==t&&(t=function(){return t.method.apply(t.scope,arguments)},t.scope=e,t.method=n,e.hx__closures__[n.__id__]=t),t}var r=function(e,n){n=n.split("u").join(""),this.r=new RegExp(e,n)};r.__name__=!0,r.prototype={match:function(e){return this.r.global&&(this.r.lastIndex=0),this.r.m=this.r.exec(e),this.r.s=e,null!=this.r.m},matched:function(e){if(null!=this.r.m&&e>=0&&e<this.r.m.length)return this.r.m[e];throw"EReg::matched"},replace:function(e,n){return e.replace(this.r,n)},__class__:r};var o=function(){};o.__name__=!0,o.cca=function(e,n){var t=e.charCodeAt(n);return t!=t?void 0:t},o.substr=function(e,n,t){return null!=n&&0!=n&&null!=t&&0>t?"":(null==t&&(t=e.length),0>n?(n=e.length+n,0>n&&(n=0)):0>t&&(t=e.length+t-n),e.substr(n,t))},o.iter=function(e){return{cur:0,arr:e,hasNext:function(){return this.cur<this.arr.length},next:function(){return this.arr[this.cur++]}}};var i=function(){this.length=0};i.__name__=!0,i.prototype={add:function(e){var n=[e];null==this.h?this.h=n:this.q[1]=n,this.q=n,this.length++},push:function(e){var n=[e,this.h];this.h=n,null==this.q&&(this.q=n),this.length++},first:function(){return null==this.h?null:this.h[0]},last:function(){return null==this.q?null:this.q[0]},pop:function(){if(null==this.h)return null;var e=this.h[0];return this.h=this.h[1],null==this.h&&(this.q=null),this.length--,e},clear:function(){this.h=null,this.q=null,this.length=0},remove:function(e){for(var n=null,t=this.h;null!=t;){if(t[0]==e)return null==n?this.h=t[1]:n[1]=t[1],this.q==t&&(this.q=n),this.length--,!0;n=t,t=t[1]}return!1},iterator:function(){return{h:this.h,hasNext:function(){return null!=this.h},next:function(){if(null==this.h)return null;var e=this.h[0];return this.h=this.h[1],e}}},map:function(e){for(var n=new i,t=this.h;null!=t;){var r=t[0];t=t[1],n.add(e(r))}return n},__class__:i};var s=function(){};s.__name__=!0,Math.__name__=!0;var u=function(){};u.__name__=!0,u.hasField=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},u.field=function(e,n){try{return e[n]}catch(t){return null}},u.fields=function(e){var n=[];if(null!=e){var t=Object.prototype.hasOwnProperty;for(var r in e)"__id__"!=r&&"hx__closures__"!=r&&t.call(e,r)&&n.push(r)}return n};var a=function(){};a.__name__=!0,a.parseInt=function(e){var n=parseInt(e,10);return 0!=n||120!=o.cca(e,1)&&88!=o.cca(e,1)||(n=parseInt(e)),isNaN(n)?null:n},a.parseFloat=function(e){return parseFloat(e)};var l={};l.ds={},l.ds.StringMap=function(){this.h={}},l.ds.StringMap.__name__=!0,l.ds.StringMap.__interfaces__=[s],l.ds.StringMap.prototype={set:function(e,n){this.h["$"+e]=n},get:function(e){return this.h["$"+e]},exists:function(e){return this.h.hasOwnProperty("$"+e)},keys:function(){var e=[];for(var n in this.h)this.h.hasOwnProperty(n)&&e.push(n.substr(1));return o.iter(e)},iterator:function(){return{ref:this.h,it:this.keys(),hasNext:function(){return this.it.hasNext()},next:function(){var e=this.it.next();return this.ref["$"+e]}}},__class__:l.ds.StringMap};var c={};c.onquery={},c.onquery.SignalContext=function(e){l.ds.StringMap.call(this),this._parent=e},c.onquery.SignalContext.__name__=!0,c.onquery.SignalContext.__super__=l.ds.StringMap,c.onquery.SignalContext.prototype=n(l.ds.StringMap.prototype,{getParent:function(){return this._parent},setParent:function(e){return this._parent=e},get:function(e){return l.ds.StringMap.prototype.exists.call(this,e)?l.ds.StringMap.prototype.get.call(this,e):null!=this._parent?this._parent.get(e):null},exists:function(e){return l.ds.StringMap.prototype.exists.call(this,e)?!0:null!=this._parent?this._parent.exists(e):!1},keys:function(){return this.getMap().keys()},getMap:function(){var e=new l.ds.StringMap;if(null!=this._parent)for(var n=this._parent.keys();n.hasNext();){var t=n.next();e.set(t,this._parent.get(t))}for(var r=this.keys();r.hasNext();){var o=r.next();e.set(o,l.ds.StringMap.prototype.get.call(this,o))}return e},iterator:function(){return this.getMap().iterator()},__class__:c.onquery.SignalContext}),c.onquery.OnQuery=e.onQuery=function(){},c.onquery.OnQuery.__name__=!0,c.onquery.OnQuery.watch=e.watch=function(e){return"string"==typeof e&&(e=c.onquery.OnQuery.buildTarget(e)),c.onquery.utils.ContextUtils.getWatcher(c.onquery.utils.ContextUtils.getContext(e))},c.onquery.OnQuery.when=e.when=function(e){return c.onquery.utils.ContextUtils.getWatcher(c.onquery.OnQuery.globalContext).on(e)},c.onquery.OnQuery.main=function(){new c.onquery.Watcher(c.onquery.OnQuery.globalContext);var n=e,t=n.jQuery;null!=t&&(c.onquery.OnQuery.buildTarget=t,t.fn.dispatchEvent=t.fn.trigger,t.fn.addEventListener=function(e,n){var t=this;t.on(e,n)},t.fn.removeEventListener=function(e,n){var t=this;t.off(e,n)})},c.onquery.Watcher=function(e){this.context=e,c.onquery.utils.ContextUtils.setWatcher(e,this)},c.onquery.Watcher.__name__=!0,c.onquery.Watcher.prototype={bind:function(e,n){this.on(e).addListener(n)},on:function(e){var n=this.context.get(e);return null==n&&(n=c.onquery.core.Interpreter.compile(e,this.context),this.context.set(e,n)),n},unbind:function(e,n){this.on(e).removeListener(n)},use:function(e){for(var n=new c.onquery.SignalContext,t=0,r=u.fields(e);t<r.length;){var o=r[t];++t;var i=u.field(e,o);"string"==typeof i&&(i=this.on(i)),n.set(o,i)}return n.setParent(this.context),new c.onquery.Watcher(n)},__class__:c.onquery.Watcher},c.onquery.collections={},c.onquery.collections.ListenersCollection=function(){},c.onquery.collections.ListenersCollection.__name__=!0,c.onquery.collections.ListenersCollection.prototype={__class__:c.onquery.collections.ListenersCollection},c.onquery.collections.ListenersArray=function(e){this.self=e,this.list=new i},c.onquery.collections.ListenersArray.__name__=!0,c.onquery.collections.ListenersArray.__interfaces__=[c.onquery.collections.ListenersCollection],c.onquery.collections.ListenersArray.prototype={removeListener:function(e){this.list.remove(e)},addListener:function(e){this.list.add(e)},invokeListeners:function(e){for(var n=this.list.iterator();n.hasNext();){var t=n.next();t.apply(this.self,e)}},removeAllListeners:function(){this.list.clear()},__class__:c.onquery.collections.ListenersArray},c.onquery.core={},c.onquery.core.Interpreter=function(){},c.onquery.core.Interpreter.__name__=!0,c.onquery.core.Interpreter.compile=function(e,n){for(var t=c.onquery.core.Interpreter.interpt(e),r=new i,o=t.iterator();o.hasNext();){var s=o.next();_.Boot.__instanceof(s,c.onquery.core.Connector)?r.add(s):_.Boot.__instanceof(s,c.onquery.core.SignalPrototype)&&r.add(c.onquery.core.Interpreter.build(s,n))}var u=c.onquery.core.Interpreter.combine(r,n);return u.setType(e),u},c.onquery.core.Interpreter.combine=function(e,n){if(e.length<2)return e.first();for(var t=new Array,r=e.iterator();r.hasNext();){var o=r.next();if(_.Boot.__instanceof(o,c.onquery.signals.ZombieSignal)){for(var s=0,u=new i;t.length>0;){var a=t.pop();if(u.push(a),a==c.onquery.core.Connector.OPEN?s++:a==c.onquery.core.Connector.CLOSE&&s--,0==s)break}var l=c.onquery.core.Interpreter.combine(u,n);l=c.onquery.core.Interpreter.attach(l,o.properties),t.push(l)}else t.push(o)}for(var h=new i,y=0;y<t.length;){var p=t[y];++y,h.add(p)}var f=new c.onquery.signals.ConnectedSignal(n,h);return f},c.onquery.core.Interpreter.build=function(e,n){var t=null,i=new r("^([$#\\*])?(.*)","");i.match(e.type);var s=i.matched(1),u=i.matched(2);switch("*"==s&&(s="#"),s){case"$":t=n.get(o.substr(e.type,1,null));break;case"#":t=c.onquery.core.Build.registry.get(u)(e,n);break;default:t=new c.onquery.signals.Signal(n),t.setType(e.type)}return c.onquery.core.Interpreter.attach(t,e.properties),t},c.onquery.core.Interpreter.attach=function(e,n){for(var t=n.iterator();t.hasNext();){var r=t.next();_.Boot.__instanceof(r,c.onquery.pseudos.Pseudo)?e=r.attach(e):_.Boot.__instanceof(r,c.onquery.filters.Filter)&&e.filters.add(r)}return e},c.onquery.core.Interpreter.interpt=function(e){for(var n=new r("^:([:\\w]*)\\(([^\\)]*)\\)?",""),t=new r("^[>+!&{}]",""),s=new r("^[<>+~!@$%^&{};,=]+",""),u=new r("^[_$#\\*\\-\\.\\w]+",""),a=new r("^\\[[^\\]]*\\]",""),l=new r("^\\s+",""),_=new i;e.length>0;)if(l.match(e))e=l.replace(e,"");else if(u.match(e)){var h=u.matched(0);e=u.replace(e,"");var y=new c.onquery.core.SignalPrototype;y.type=h,_.add(y)}else if(a.match(e)){var p=a.matched(0);e=a.replace(e,""),p=o.substr(p,1,null),p=o.substr(p,0,p.length-1);var f="",g="";u.match(p)&&(f=u.matched(0),p=u.replace(p,"")),s.match(p)&&(g=s.matched(0),p=s.replace(p,""));var q=c.onquery.core.Interpreter.lastPrototype(_);q.properties.add(new c.onquery.filters.PropertyFilter(f,g,p))}else if(n.match(e)){var d=c.onquery.pseudos.Pseudo.getInstance(n.matched(1),n.matched(2));e=n.replace(e,"");var m=c.onquery.core.Interpreter.lastPrototype(_);m.properties.add(d)}else{if(!t.match(e))throw"error parsing "+o.substr(e,0,20);var v=t.matched(0),S=c.onquery.core.Connector.registry.get(v);e=t.replace(e,""),_.add(S)}return _},c.onquery.core.Interpreter.lastPrototype=function(e){var n=e.last();return _.Boot.__instanceof(n,c.onquery.core.SignalPrototype)?n:(n=new c.onquery.core.SignalPrototype,n.type="#zombie",e.add(n),n)},c.onquery.core.SignalPrototype=function(){this.type="",this.properties=new i},c.onquery.core.SignalPrototype.__name__=!0,c.onquery.core.SignalPrototype.prototype={__class__:c.onquery.core.SignalPrototype};var _={};_.Boot=function(){},_.Boot.__name__=!0,_.Boot.getClass=function(e){return e instanceof Array&&null==e.__enum__?Array:e.__class__},_.Boot.__interfLoop=function(e,n){if(null==e)return!1;if(e==n)return!0;var t=e.__interfaces__;if(null!=t)for(var r=0,o=t.length;o>r;){var i=r++,s=t[i];if(s==n||_.Boot.__interfLoop(s,n))return!0}return _.Boot.__interfLoop(e.__super__,n)},_.Boot.__instanceof=function(e,n){if(null==n)return!1;switch(n){case y:return(0|e)===e;case f:return"number"==typeof e;case g:return"boolean"==typeof e;case String:return"string"==typeof e;case Array:return e instanceof Array&&null==e.__enum__;case p:return!0;default:if(null==e)return!1;if("function"==typeof n){if(e instanceof n)return!0;if(_.Boot.__interfLoop(_.Boot.getClass(e),n))return!0}return n==q&&null!=e.__name__?!0:n==d&&null!=e.__ename__?!0:e.__enum__==n}},c.onquery.filters={},c.onquery.filters.Filter=function(){},c.onquery.filters.Filter.__name__=!0,c.onquery.filters.Filter.prototype={__class__:c.onquery.filters.Filter},c.onquery.filters.PropertyFilter=function(e,n,t){this.name=e,this.operator=n;var o=new r('"(.*)"',""),i=t;"true"==i?i=!0:"false"==i?i=!1:Math.isNaN(i)?o.match(i)&&(i=o.matched(1)):i=a.parseFloat(i),this.value=i},c.onquery.filters.PropertyFilter.__name__=!0,c.onquery.filters.PropertyFilter.__interfaces__=[c.onquery.filters.Filter],c.onquery.filters.PropertyFilter.contains=function(e,n){return e.indexOf(n)>-1},c.onquery.filters.PropertyFilter.exists=function(){return!0},c.onquery.filters.PropertyFilter.differs=function(e,n){return e!=n},c.onquery.filters.PropertyFilter.equals=function(e,n){return e==n},c.onquery.filters.PropertyFilter.boolEquals=function(e,n){return!!e==!!n},c.onquery.filters.PropertyFilter.greaterThan=function(e,n){return e>n},c.onquery.filters.PropertyFilter.lessThan=function(e,n){return n>e},c.onquery.filters.PropertyFilter.prototype={match:function(e){if(!c.onquery.filters.PropertyFilter.operators.exists(this.operator))return!1;for(var n=e,t=this.name.split(".");t.length>0;){var r=t.shift();if(r=""==r?0:r,!u.hasField(n,r))return!1;n=u.field(n,r)}return c.onquery.filters.PropertyFilter.operators.get(this.operator)(n,this.value)},__class__:c.onquery.filters.PropertyFilter},c.onquery.pseudos={},c.onquery.pseudos.Pseudo=function(e){this.setName(e)},c.onquery.pseudos.Pseudo.__name__=!0,c.onquery.pseudos.Pseudo.getInstance=function(e,n){var t=null;switch(e){case"rewind":t=new c.onquery.pseudos.RewindPseudo;break;case"pause":t=new c.onquery.pseudos.PausePseudo;break;case"delay":t=new c.onquery.pseudos.DelayPseudo;break;case"throttle":t=new c.onquery.pseudos.ThrottlePseudo;break;default:t=new c.onquery.pseudos.Pseudo(e)}return t.setValue(n),t},c.onquery.pseudos.Pseudo.prototype={getName:function(){return this._name},setName:function(e){return this._name=e},getValue:function(){return this._value},setValue:function(e){return this._value=e},attach:function(e){return e},__class__:c.onquery.pseudos.Pseudo},c.onquery.pseudos.RewindPseudo=function(){c.onquery.pseudos.Pseudo.call(this,"rewind")},c.onquery.pseudos.RewindPseudo.__name__=!0,c.onquery.pseudos.RewindPseudo.__super__=c.onquery.pseudos.Pseudo,c.onquery.pseudos.RewindPseudo.prototype=n(c.onquery.pseudos.Pseudo.prototype,{attach:function(e){var n=e;return n.setRewinder(c.onquery.core.Interpreter.compile(this.getValue(),n.getContext())),e},__class__:c.onquery.pseudos.RewindPseudo}),c.onquery.pseudos.PausePseudo=function(){this.paused=!1,c.onquery.pseudos.Pseudo.call(this,"pause")},c.onquery.pseudos.PausePseudo.__name__=!0,c.onquery.pseudos.PausePseudo.__interfaces__=[c.onquery.filters.Filter],c.onquery.pseudos.PausePseudo.__super__=c.onquery.pseudos.Pseudo,c.onquery.pseudos.PausePseudo.prototype=n(c.onquery.pseudos.Pseudo.prototype,{attach:function(e){return this._signal=e,e.filters.add(this),e},match:function(e){return null!=this.timer&&(this.timer.stop(),this.timer=null),this.paused?(this.paused=!1,!0):(this.lastArgs=e,this.timer=l.Timer.delay(t(this,this.onPause),a.parseInt("0"+this.getValue())),!1)},onPause:function(){this.paused=!0,this._signal.invokeListeners(this.lastArgs)},__class__:c.onquery.pseudos.PausePseudo}),c.onquery.pseudos.DelayPseudo=function(){this.delayed=!1,c.onquery.pseudos.Pseudo.call(this,"delay")},c.onquery.pseudos.DelayPseudo.__name__=!0,c.onquery.pseudos.DelayPseudo.__interfaces__=[c.onquery.filters.Filter],c.onquery.pseudos.DelayPseudo.__super__=c.onquery.pseudos.Pseudo,c.onquery.pseudos.DelayPseudo.prototype=n(c.onquery.pseudos.Pseudo.prototype,{attach:function(e){return this._signal=e,e.filters.add(this),e},match:function(e){var n=this;if(this.delayed)return this.delayed=!1,!0;var t=function(){n.delayed=!0,n._signal.invokeListeners(e)};return l.Timer.delay(t,a.parseInt("0"+this.getValue())),!1},__class__:c.onquery.pseudos.DelayPseudo}),c.onquery.pseudos.ThrottlePseudo=function(){this.throttling=!1,c.onquery.pseudos.Pseudo.call(this,"throttle")},c.onquery.pseudos.ThrottlePseudo.__name__=!0,c.onquery.pseudos.ThrottlePseudo.__interfaces__=[c.onquery.filters.Filter],c.onquery.pseudos.ThrottlePseudo.__super__=c.onquery.pseudos.Pseudo,c.onquery.pseudos.ThrottlePseudo.prototype=n(c.onquery.pseudos.Pseudo.prototype,{attach:function(e){return this._signal=e,e.filters.add(this),e},match:function(){return this.throttling?!1:(this.throttling=!0,l.Timer.delay(t(this,this.onThrottle),a.parseInt("0"+this.getValue())),!0)},onThrottle:function(){this.throttling=!1},__class__:c.onquery.pseudos.ThrottlePseudo}),c.onquery.core.SignalToken=function(e){this.time=0,this.count=0,this.setSignal(e)},c.onquery.core.SignalToken.__name__=!0,c.onquery.core.SignalToken.prototype={getSignal:function(){return this._signal},setSignal:function(e){return this._signal==e?this._signal:(this._signal=e,null!=this._signal&&this._signal.addListener(t(this,this.refresh)),this._signal)},refresh:function(){this.time=c.onquery.core.SignalToken.currentTime++,this.count++},reset:function(){this.count=0,this.time=0},__class__:c.onquery.core.SignalToken},c.onquery.core.Connector=function(e,n,t,r){null==r&&(r=!1),null==t&&(t=0),null==n&&(n=0),this.connect=e,this.argc=n,this.precedence=t,this.leftAssociative=r},c.onquery.core.Connector.__name__=!0,c.onquery.core.Connector.prototype={__class__:c.onquery.core.Connector},c.onquery.signals={},c.onquery.signals.CoreSignal=function(e){this._context=new c.onquery.SignalContext(e),this._context.set("this",this),this.listeners=new c.onquery.collections.ListenersArray(this.getTarget())},c.onquery.signals.CoreSignal.__name__=!0,c.onquery.signals.CoreSignal.__interfaces__=[c.onquery.collections.ListenersCollection],c.onquery.signals.CoreSignal.prototype={getContext:function(){return this._context},getTarget:function(){return c.onquery.utils.ContextUtils.getTarget(this._context)},getType:function(){return this._type},setType:function(e){return this._type=e},addListener:function(e){this.listeners.addListener(e)},removeListener:function(e){this.listeners.removeListener(e)},removeAllListeners:function(){this.listeners.removeAllListeners()},invokeListeners:function(e){this.lastArgs=e,this.listeners.invokeListeners(e)},__class__:c.onquery.signals.CoreSignal},c.onquery.signals.Signal=function(e){c.onquery.signals.CoreSignal.call(this,e),this.filters=new i},c.onquery.signals.Signal.__name__=!0,c.onquery.signals.Signal.__super__=c.onquery.signals.CoreSignal,c.onquery.signals.Signal.prototype=n(c.onquery.signals.CoreSignal.prototype,{setType:function(e){return e=c.onquery.signals.CoreSignal.prototype.setType.call(this,e),this.getTarget().addEventListener(e,t(this,this.handle),!1),e},dispose:function(){this.getTarget().removeEventListener(this.getType(),t(this,this.handle),!1),this.listeners=null},handle:function(){this.invokeListeners(arguments)},invokeListeners:function(e){for(var n=this.filters.iterator();n.hasNext();){var t=n.next();if(!t.match(e))return}c.onquery.signals.CoreSignal.prototype.invokeListeners.call(this,e)},__class__:c.onquery.signals.Signal}),c.onquery.signals.CombinedSignal=function(e){c.onquery.signals.Signal.call(this,e),this.setRewinder(this)},c.onquery.signals.CombinedSignal.__name__=!0,c.onquery.signals.CombinedSignal.__super__=c.onquery.signals.Signal,c.onquery.signals.CombinedSignal.prototype=n(c.onquery.signals.Signal.prototype,{setRewinder:function(e){return null!=this._rewinder&&this._rewinder.removeListener(t(this,this.rewind)),this._rewinder=e,null!=this._rewinder&&this._rewinder.addListener(t(this,this.rewind)),this._rewinder},rewind:function(){throw"not implimented"},__class__:c.onquery.signals.CombinedSignal}),c.onquery.signals.IntervalSignal=function(e,n){c.onquery.signals.CombinedSignal.call(this,e),this.delay=n,this.rewind(null)},c.onquery.signals.IntervalSignal.__name__=!0,c.onquery.signals.IntervalSignal.build=function(e,n){return new c.onquery.signals.IntervalSignal(n,a.parseInt(c.onquery.core.Build.popArg(e)))},c.onquery.signals.IntervalSignal.__super__=c.onquery.signals.CombinedSignal,c.onquery.signals.IntervalSignal.prototype=n(c.onquery.signals.CombinedSignal.prototype,{tick:function(){this.invokeListeners([])},rewind:function(){null!=this.timer&&this.timer.stop(),this.timer=new l.Timer(this.delay),this.timer.run=t(this,this.tick)},dispose:function(){null!=this.timer&&(this.timer.stop(),this.timer=null),c.onquery.signals.CombinedSignal.prototype.dispose.call(this)},__class__:c.onquery.signals.IntervalSignal}),c.onquery.signals.AllSignal=function(e,n){c.onquery.signals.CombinedSignal.call(this,e),this.queue=new i;for(var r=n.iterator();r.hasNext();){var o=r.next();this.queue.add(new c.onquery.core.SignalToken(o)),o.addListener(t(this,this.recheck))}this.rewind(null)},c.onquery.signals.AllSignal.__name__=!0,c.onquery.signals.AllSignal.build=function(e,n){for(var t=c.onquery.core.Interpreter.interpt(c.onquery.core.Build.popArg(e)),r=new i,o=t.iterator();o.hasNext();){var s=o.next();r.add(c.onquery.core.Interpreter.build(s,n))}var u=new c.onquery.signals.AllSignal(n,r);return u.setType(e.type),u},c.onquery.signals.AllSignal.__super__=c.onquery.signals.CombinedSignal,c.onquery.signals.AllSignal.prototype=n(c.onquery.signals.CombinedSignal.prototype,{rewind:function(){for(var e=this.queue.iterator();e.hasNext();){var n=e.next();n.reset()}},recheck:function(){for(var e=!0,n=this.queue.iterator();e&&n.hasNext();)e=n.next().count>0;if(e){this.lastArgs=[];for(var t=this.queue.iterator();t.hasNext();){var r=t.next();this.lastArgs.push(r.getSignal().lastArgs)}this.invokeListeners(this.lastArgs)}},__class__:c.onquery.signals.AllSignal}),c.onquery.signals.SequenceSignal=function(e,n){c.onquery.signals.CombinedSignal.call(this,e),this.queue=n,this.rewind()},c.onquery.signals.SequenceSignal.__name__=!0,c.onquery.signals.SequenceSignal.build=function(e,n){for(var t=c.onquery.core.Interpreter.interpt(c.onquery.core.Build.popArg(e)),r=[],o=t.iterator();o.hasNext();){var i=o.next();r.push(c.onquery.core.Interpreter.build(i,n))}var s=new c.onquery.signals.SequenceSignal(n,r);return s.setType(e.type),s},c.onquery.signals.SequenceSignal.__super__=c.onquery.signals.CombinedSignal,c.onquery.signals.SequenceSignal.prototype=n(c.onquery.signals.CombinedSignal.prototype,{rewind:function(){this.reset(),this.nextSignal()},reset:function(){for(var e=0,n=this.queue;e<n.length;){var r=n[e];++e,r.removeListener(t(this,this.nextSignal))}this.index=-1},nextSignal:function(){var e=++this.index;e==this.queue.length?(this.lastArgs=this.queue.map(function(e){return e.lastArgs}),this.invokeListeners(this.lastArgs)):(e%=this.queue.length,this.reset(),this.index=e,this.queue[e].addListener(t(this,this.nextSignal)))},dispose:function(){this.reset(),c.onquery.signals.CombinedSignal.prototype.dispose.call(this)},__class__:c.onquery.signals.SequenceSignal}),c.onquery.signals.ZombieSignal=function(e){c.onquery.signals.Signal.call(this,e)},c.onquery.signals.ZombieSignal.__name__=!0,c.onquery.signals.ZombieSignal.build=function(e,n){var t=new c.onquery.signals.ZombieSignal(n);return t.properties=e.properties,e.properties=new i,t},c.onquery.signals.ZombieSignal.__super__=c.onquery.signals.Signal,c.onquery.signals.ZombieSignal.prototype=n(c.onquery.signals.Signal.prototype,{__class__:c.onquery.signals.ZombieSignal}),c.onquery.signals.ConnectedSignal=function(e,n){c.onquery.signals.CombinedSignal.call(this,e),this.queue=new i,this.signals=[],this.setTokens(n)},c.onquery.signals.ConnectedSignal.__name__=!0,c.onquery.signals.ConnectedSignal.__super__=c.onquery.signals.CombinedSignal,c.onquery.signals.ConnectedSignal.prototype=n(c.onquery.signals.CombinedSignal.prototype,{rewind:function(){for(var e=this.queue.iterator();e.hasNext();){var n=e.next();_.Boot.__instanceof(n,c.onquery.core.SignalToken)&&n.reset()}},recheck:function(){var e=this.reduce().count;e>0&&(this.lastArgs=this.signals.map(function(e){return e.lastArgs}),this.invokeListeners(this.lastArgs))},reduce:function(){for(var e,n=new i,t=0,r=this.queue.map(function(e){return e});e=r.pop();)if(_.Boot.__instanceof(e,c.onquery.core.SignalToken))n.push(e),++t;else{if(!_.Boot.__instanceof(e,c.onquery.core.Connector))throw"unexpected token";var o=e;if(t<o.argc)throw"too few arguments for operator";var s=new i;s.add(n.pop()),2==o.argc&&s.push(n.pop()),t-=o.argc-1;var u=o.connect(s);n.push(u)}if(1==n.length)return n.pop();throw"too many values"},setTokens:function(e){for(var n=new i,r=e.iterator();r.hasNext();){var o=r.next();if(_.Boot.__instanceof(o,c.onquery.signals.Signal))this.signals.push(o),this.queue.add(new c.onquery.core.SignalToken(o)),o.addListener(t(this,this.recheck));else{if(!_.Boot.__instanceof(o,c.onquery.core.Connector))throw"unknown token";var s=o;if(s==c.onquery.core.Connector.OPEN)n.push(s);else if(s==c.onquery.core.Connector.CLOSE){for(var u,a=!1;u=n.pop();){if(u==c.onquery.core.Connector.OPEN){a=!0;break}this.queue.add(u)}if(!a)throw"unmatched parentheses"}else{for(var l,h=s;l=n.first();){var y=l;if(y==c.onquery.core.Connector.OPEN||y==c.onquery.core.Connector.CLOSE)break;var p=h.precedence,f=y.precedence;if(!(h.leftAssociative&&f>=p||f>p))break;this.queue.add(n.pop())}n.push(h)}}}for(var g;g=n.pop();){if(g==c.onquery.core.Connector.OPEN||g==c.onquery.core.Connector.CLOSE)throw"unmatched parentheses";this.queue.add(g)}},__class__:c.onquery.signals.ConnectedSignal}),c.onquery.core.Build=function(){},c.onquery.core.Build.__name__=!0,c.onquery.core.Build.popArg=function(e){var n="",t=e.properties.first();return _.Boot.__instanceof(t,c.onquery.pseudos.Pseudo)&&""==t.getName()&&(n=t.getValue(),e.properties.pop()),n},c.onquery.core.Build.wrap=function(e,n){return c.onquery.core.Interpreter.compile(c.onquery.core.Build.popArg(e),n)},c.onquery.utils={},c.onquery.utils.ContextUtils=function(){},c.onquery.utils.ContextUtils.__name__=!0,c.onquery.utils.ContextUtils.getTarget=function(e){return e.get("_target_")},c.onquery.utils.ContextUtils.setTarget=function(e,n){return e.set("_target_",n)},c.onquery.utils.ContextUtils.getWatcher=function(e){return e.get("_watcher_")},c.onquery.utils.ContextUtils.setWatcher=function(e,n){return e.set("_watcher_",n)},c.onquery.utils.ContextUtils.getContext=function(e){var n=new Event("_context_");if(e.dispatchEvent(n),null==n.context){var t=new c.onquery.SignalContext;return t.setParent(c.onquery.OnQuery.globalContext),c.onquery.utils.ContextUtils.setTarget(t,e),new c.onquery.Watcher(t),e.addEventListener("_context_",function(e){e.context=t}),t}return n.context},l.Timer=function(e){var n=this;this.id=setInterval(function(){n.run()},e)},l.Timer.__name__=!0,l.Timer.delay=function(e,n){var t=new l.Timer(n);return t.run=function(){t.stop(),e()},t},l.Timer.prototype={stop:function(){null!=this.id&&(clearInterval(this.id),this.id=null)},run:function(){},__class__:l.Timer};var h=0;Math.NaN=Number.NaN,Math.NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,Math.POSITIVE_INFINITY=Number.POSITIVE_INFINITY,Math.isFinite=function(e){return isFinite(e)},Math.isNaN=function(e){return isNaN(e)},String.prototype.__class__=String,String.__name__=!0,Array.__name__=!0;var y={__name__:["Int"]},p={__name__:["Dynamic"]},f=Number;f.__name__=["Float"];var g=Boolean;g.__ename__=["Bool"];var q={__name__:["Class"]},d={};null==Array.prototype.map&&(Array.prototype.map=function(e){for(var n=[],t=0,r=this.length;r>t;){var o=t++;n[o]=e(this[o])}return n}),c.onquery.OnQuery.globalContext=new c.onquery.SignalContext(function(){var e,n=new l.ds.StringMap;return n.set("version","0.0.1"),e=n}(this)),c.onquery.filters.PropertyFilter.operators=function(){var e,n=new l.ds.StringMap;return n.set("",c.onquery.filters.PropertyFilter.exists),n.set("=",c.onquery.filters.PropertyFilter.equals),n.set("*=",c.onquery.filters.PropertyFilter.contains),n.set("!=",c.onquery.filters.PropertyFilter.differs),n.set("==",c.onquery.filters.PropertyFilter.boolEquals),n.set(">",c.onquery.filters.PropertyFilter.greaterThan),n.set("<",c.onquery.filters.PropertyFilter.lessThan),e=n}(this),c.onquery.core.SignalToken.currentTime=1,c.onquery.core.Connector.OPEN=new c.onquery.core.Connector(null),c.onquery.core.Connector.CLOSE=new c.onquery.core.Connector(null),c.onquery.core.Connector.NOT=new c.onquery.core.Connector(function(e){var n=new c.onquery.core.SignalToken,t=e.first();return n.time=t.time,n.count=t.count>0?0:1,n},1,100,!1),c.onquery.core.Connector.OR=new c.onquery.core.Connector(function(e){var n=new c.onquery.core.SignalToken,t=e.first(),r=e.last();return n.time=Math.max(t.time,r.time),n.count=Math.max(t.count,r.count),n},2,80,!1),c.onquery.core.Connector.AND=new c.onquery.core.Connector(function(e){var n=new c.onquery.core.SignalToken,t=e.first(),r=e.last();return n.time=Math.max(t.time,r.time),n.count=Math.min(t.count,r.count),n},2,90,!1),c.onquery.core.Connector.NEXT=new c.onquery.core.Connector(function(e){var n=e.first(),t=e.last(),r=new c.onquery.core.SignalToken;return n.time<t.time&&(r.count=Math.min(n.count,t.count),r.time=t.time),r},2,70,!0),c.onquery.core.Connector.registry=function(){var e,n=new l.ds.StringMap;return n.set("+",c.onquery.core.Connector.OR),n.set("!",c.onquery.core.Connector.NOT),n.set("&",c.onquery.core.Connector.AND),n.set(">",c.onquery.core.Connector.NEXT),n.set("{",c.onquery.core.Connector.OPEN),n.set("}",c.onquery.core.Connector.CLOSE),e=n}(this),c.onquery.core.Build.registry=function(){var e,n=new l.ds.StringMap;return n.set("",c.onquery.core.Build.wrap),n.set("timeout",null),n.set("interval",c.onquery.signals.IntervalSignal.build),n.set("any",null),n.set("all",c.onquery.signals.AllSignal.build),n.set("seq",c.onquery.signals.SequenceSignal.build),n.set("zombie",c.onquery.signals.ZombieSignal.build),e=n}(this),c.onquery.OnQuery.main()}("undefined"!=typeof window?window:exports);